{"version":3,"file":"index.js","sources":["../../src/utils.ts","../../src/instrumentation.ts"],"sourcesContent":["import { trace, context, Tracer, SpanStatusCode } from \"@opentelemetry/api\";\nimport { safeExecuteInTheMiddle } from \"@opentelemetry/instrumentation\";\nimport {\n  TraceloopSpanKindValues,\n  SpanAttributes,\n} from \"@traceloop/ai-semantic-conventions\";\n\nexport function genericWrapper(\n  tracer: () => Tracer,\n  shouldSendPrompts: boolean,\n  spanKind: TraceloopSpanKindValues,\n  spanName?: string,\n) {\n  // eslint-disable-next-line\n  return (original: Function) => {\n    return function method(this: any, ...args: unknown[]) {\n      const span = tracer().startSpan(\n        spanName || `${this.constructor.name}.${spanKind}`,\n      );\n      span.setAttribute(SpanAttributes.TRACELOOP_SPAN_KIND, spanKind);\n\n      if (shouldSendPrompts) {\n        try {\n          if (\n            args.length === 1 &&\n            typeof args[0] === \"object\" &&\n            !(args[0] instanceof Map)\n          ) {\n            span.setAttribute(\n              SpanAttributes.TRACELOOP_ENTITY_INPUT,\n              JSON.stringify({ args: [], kwargs: args[0] }),\n            );\n          } else {\n            span.setAttribute(\n              SpanAttributes.TRACELOOP_ENTITY_INPUT,\n              JSON.stringify({\n                args: args.map((arg) =>\n                  arg instanceof Map ? Array.from(arg.entries()) : arg,\n                ),\n                kwargs: {},\n              }),\n            );\n          }\n        } catch (e) {\n          this._diag.debug(e);\n          this._config.exceptionLogger?.(e);\n        }\n      }\n\n      const execContext = trace.setSpan(context.active(), span);\n      const execPromise = safeExecuteInTheMiddle(\n        () => {\n          return context.with(execContext, () => {\n            return original.apply(this, args);\n          });\n        },\n        // eslint-disable-next-line @typescript-eslint/no-empty-function\n        () => {},\n      );\n      const wrappedPromise = execPromise\n        .then((result: any) => {\n          return new Promise((resolve) => {\n            span.setStatus({ code: SpanStatusCode.OK });\n\n            try {\n              if (shouldSendPrompts) {\n                if (result instanceof Map) {\n                  span.setAttribute(\n                    SpanAttributes.TRACELOOP_ENTITY_OUTPUT,\n                    JSON.stringify(Array.from(result.entries())),\n                  );\n                } else {\n                  span.setAttribute(\n                    SpanAttributes.TRACELOOP_ENTITY_OUTPUT,\n                    JSON.stringify(result),\n                  );\n                }\n              }\n            } catch (e) {\n              this._diag.debug(e);\n              this._config.exceptionLogger?.(e);\n            } finally {\n              span.end();\n              resolve(result);\n            }\n          });\n        })\n        .catch((error: Error) => {\n          return new Promise((_, reject) => {\n            span.setStatus({\n              code: SpanStatusCode.ERROR,\n              message: error.message,\n            });\n            span.end();\n            reject(error);\n          });\n        });\n      return context.bind(execContext, wrappedPromise as any);\n    };\n  };\n}\n\nexport function taskWrapper(\n  tracer: () => Tracer,\n  shouldSendPrompts: boolean,\n  spanName?: string,\n) {\n  return genericWrapper(\n    tracer,\n    shouldSendPrompts,\n    TraceloopSpanKindValues.TASK,\n    spanName,\n  );\n}\n\nexport function workflowWrapper(\n  tracer: () => Tracer,\n  shouldSendPrompts: boolean,\n  spanName: string,\n) {\n  return genericWrapper(\n    tracer,\n    shouldSendPrompts,\n    TraceloopSpanKindValues.WORKFLOW,\n    spanName,\n  );\n}\n","/*\n * Copyright Traceloop\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { context } from \"@opentelemetry/api\";\nimport {\n  InstrumentationBase,\n  InstrumentationModuleDefinition,\n  InstrumentationNodeModuleDefinition,\n} from \"@opentelemetry/instrumentation\";\nimport { CONTEXT_KEY_ALLOW_TRACE_CONTENT } from \"@traceloop/ai-semantic-conventions\";\nimport { LangChainInstrumentationConfig } from \"./types\";\nimport { taskWrapper, workflowWrapper } from \"./utils\";\nimport type * as ChainsModule from \"langchain/chains\";\nimport type * as AgentsModule from \"langchain/agents\";\nimport type * as ToolsModule from \"langchain/tools\";\nimport type * as VectorStoreModule from \"@langchain/core/vectorstores\";\nimport type * as RunnablesModule from \"@langchain/core/runnables\";\nimport { version } from \"../package.json\";\n\nexport class LangChainInstrumentation extends InstrumentationBase {\n  declare protected _config: LangChainInstrumentationConfig;\n\n  constructor(config: LangChainInstrumentationConfig = {}) {\n    super(\"@traceloop/instrumentation-langchain\", version, config);\n  }\n\n  public manuallyInstrument({\n    chainsModule,\n    agentsModule,\n    toolsModule,\n    vectorStoreModule,\n    runnablesModule,\n  }: {\n    chainsModule?: any;\n    agentsModule?: any;\n    toolsModule?: any;\n    vectorStoreModule?: any;\n    runnablesModule?: any;\n  }) {\n    if (chainsModule) {\n      this._diag.debug(\"Manually instrumenting langchain chains\");\n      this.patchChainModule(chainsModule);\n    }\n    if (agentsModule) {\n      this._diag.debug(\"Manually instrumenting langchain agents\");\n      this.patchAgentModule(agentsModule);\n    }\n    if (toolsModule) {\n      this._diag.debug(\"Manually instrumenting langchain tools\");\n      this.patchToolsModule(toolsModule);\n    }\n    if (vectorStoreModule) {\n      this._diag.debug(\"Manually instrumenting langchain vector stores\");\n      this.patchVectorStoreModule(vectorStoreModule);\n    }\n    if (runnablesModule) {\n      this._diag.debug(\"Manually instrumenting @langchain/core/runnables\");\n      this.patchRunnablesModule(runnablesModule);\n    }\n  }\n\n  protected init(): InstrumentationModuleDefinition[] {\n    const chainModule = new InstrumentationNodeModuleDefinition(\n      \"langchain/chains.cjs\",\n      [\">=0.3.0\"],\n      this.patchChainModule.bind(this),\n      this.unpatchChainModule.bind(this),\n    );\n    const agentModule = new InstrumentationNodeModuleDefinition(\n      \"langchain/agents.cjs\",\n      [\">=0.3.0\"],\n      this.patchAgentModule.bind(this),\n      this.unpatchAgentModule.bind(this),\n    );\n    const toolsModule = new InstrumentationNodeModuleDefinition(\n      \"langchain/tools.cjs\",\n      [\">=0.3.0\"],\n      this.patchToolsModule.bind(this),\n      this.unpatchToolsModule.bind(this),\n    );\n    const vectorStoreModule = new InstrumentationNodeModuleDefinition(\n      \"langchain/core/vectorstores.cjs\",\n      [\">=0.3.0\"],\n      this.patchVectorStoreModule.bind(this),\n      this.unpatchVectorStoreModule.bind(this),\n    );\n    const runnablesModule = new InstrumentationNodeModuleDefinition(\n      \"@langchain/core/runnables.cjs\",\n      [\">=0.3.0\"],\n      this.patchRunnablesModule.bind(this),\n      this.unpatchRunnablesModule.bind(this),\n    );\n    return [\n      chainModule,\n      agentModule,\n      toolsModule,\n      vectorStoreModule,\n      runnablesModule,\n    ];\n  }\n\n  private patchChainModule(\n    moduleExports: typeof ChainsModule,\n    moduleVersion?: string,\n  ) {\n    this._diag.debug(`Patching langchain/chains.cjs@${moduleVersion}`);\n\n    this._wrap(\n      moduleExports.RetrievalQAChain.prototype,\n      \"_call\",\n      workflowWrapper(\n        () => this.tracer,\n        this._shouldSendPrompts(),\n        \"retrieval_qa.workflow\",\n      ),\n    );\n    this._wrap(\n      moduleExports.BaseChain.prototype,\n      \"call\",\n      taskWrapper(() => this.tracer, this._shouldSendPrompts()),\n    );\n    return moduleExports;\n  }\n\n  private patchAgentModule(\n    moduleExports: typeof AgentsModule,\n    moduleVersion?: string,\n  ) {\n    this._diag.debug(`Patching langchain/agents.cjs@${moduleVersion}`);\n\n    this._wrap(\n      moduleExports.AgentExecutor.prototype,\n      \"_call\",\n      workflowWrapper(\n        () => this.tracer,\n        this._shouldSendPrompts(),\n        \"langchain.agent\",\n      ),\n    );\n    return moduleExports;\n  }\n\n  private patchToolsModule(\n    moduleExports: typeof ToolsModule,\n    moduleVersion?: string,\n  ) {\n    this._diag.debug(`Patching langchain/tools.cjs@${moduleVersion}`);\n\n    this._wrap(\n      moduleExports.Tool.prototype,\n      \"call\",\n      taskWrapper(() => this.tracer, this._shouldSendPrompts()),\n    );\n    return moduleExports;\n  }\n\n  private patchVectorStoreModule(\n    moduleExports: typeof VectorStoreModule,\n    moduleVersion?: string,\n  ) {\n    this._diag.debug(`Patching langchain/vectorstores.cjs@${moduleVersion}`);\n\n    this._wrap(\n      moduleExports.VectorStoreRetriever.prototype,\n      \"_getRelevantDocuments\",\n      taskWrapper(() => this.tracer, this._shouldSendPrompts()),\n    );\n    return moduleExports;\n  }\n\n  private patchRunnablesModule(\n    moduleExports: typeof RunnablesModule,\n    moduleVersion?: string,\n  ) {\n    this._diag.debug(`Patching @langchain/core/runnables@${moduleVersion}`);\n\n    this._wrap(\n      moduleExports.RunnableSequence.prototype,\n      \"invoke\",\n      taskWrapper(() => this.tracer, this._shouldSendPrompts()),\n    );\n    return moduleExports;\n  }\n\n  private unpatchChainModule(\n    moduleExports: typeof ChainsModule,\n    moduleVersion?: string,\n  ) {\n    this._diag.debug(`Unpatching langchain/chains.cjs@${moduleVersion}`);\n\n    this._unwrap(moduleExports.RetrievalQAChain.prototype, \"_call\");\n    this._unwrap(moduleExports.BaseChain.prototype, \"call\");\n    return moduleExports;\n  }\n\n  private unpatchAgentModule(\n    moduleExports: typeof AgentsModule,\n    moduleVersion?: string,\n  ) {\n    this._diag.debug(`Unpatching langchain/agents.cjs@${moduleVersion}`);\n\n    this._unwrap(moduleExports.AgentExecutor.prototype, \"_call\");\n    return moduleExports;\n  }\n\n  private unpatchToolsModule(moduleExports: typeof ToolsModule) {\n    this._diag.debug(`Unpatching langchain/tools.cjs`);\n\n    this._unwrap(moduleExports.Tool.prototype, \"call\");\n    return moduleExports;\n  }\n\n  private unpatchVectorStoreModule(moduleExports: typeof VectorStoreModule) {\n    this._diag.debug(`Unpatching langchain/vectorstores.cjs`);\n\n    this._unwrap(\n      moduleExports.VectorStoreRetriever.prototype,\n      \"_getRelevantDocuments\",\n    );\n    return moduleExports;\n  }\n\n  private unpatchRunnablesModule(moduleExports: typeof RunnablesModule) {\n    this._diag.debug(`Unpatching @langchain/core/runnables`);\n\n    this._unwrap(moduleExports.Runnable.prototype, \"invoke\");\n    return moduleExports;\n  }\n\n  private _shouldSendPrompts() {\n    const contextShouldSendPrompts = context\n      .active()\n      .getValue(CONTEXT_KEY_ALLOW_TRACE_CONTENT);\n\n    if (contextShouldSendPrompts !== undefined) {\n      return !!contextShouldSendPrompts;\n    }\n\n    return this._config.traceContent !== undefined\n      ? this._config.traceContent\n      : true;\n  }\n}\n"],"names":["SpanAttributes","trace","context","safeExecuteInTheMiddle","SpanStatusCode","TraceloopSpanKindValues","InstrumentationBase","InstrumentationNodeModuleDefinition","CONTEXT_KEY_ALLOW_TRACE_CONTENT"],"mappings":"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"}